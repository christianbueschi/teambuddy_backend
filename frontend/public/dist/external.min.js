(function(){var a,b=this;a="undefined"!=typeof exports?exports:b.Tc={},a.$=b.jQuery||b.Zepto||b.$,function(){var a=!1,b=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)f[g]="function"==typeof c[g]&&"function"==typeof e[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,c[g]):c[g];return d.prototype=f,d.constructor=d,d.extend=arguments.callee,d}}(),a.Config={dependencies:{css:"/css/dependencies",js:"/js/dependencies"}},a.Application=Class.extend({init:function(b,c){this.config=$.extend({},a.Config,c),this.$ctx=b||$("body"),this.modules=[],this.connectors={},this.sandbox=new a.Sandbox(this,this.config)},registerModules:function(b){var c=this,d=[],e=a.Utils.String;return b=b||this.$ctx,b.find('.mod:not([data-ignore="true"])').add(b).each(function(){var b=$(this),f=b.attr("class")||"";if(f=f.split(" "),f.length>1){for(var g,h,i=[],j=[],k=0,l=f.length;l>k;k++){var m=$.trim(f[k]);m&&(m.indexOf("-")>-1&&(m=e.toCamel(m)),0===m.indexOf("mod")&&m.length>3?g=m.substr(3):0===m.indexOf("skin")&&i.push(m.substr(4).replace(g,"")))}if(h=b.attr("data-connectors")){j=h.split(",");for(var k=0,l=j.length;l>k;k++){var n=$.trim(j[k]);n&&(j[k]=n)}}g&&a.Module[g]&&d.push(c.registerModule(b,g,i,j))}}),d},unregisterModules:function(a){var b=this.connectors;if(a=a||this.modules,a===this.modules)this.connectors=[],this.modules=[];else for(var c=0,d=a.length;d>c;c++){var e,f=a[c];for(var g in b)b.hasOwnProperty(g)&&b[g].unregisterComponent(f);e=$.inArray(f,this.modules),e>-1&&delete this.modules[e]}},end:function(a){"function"==typeof a&&this.sandbox.addCallback("end",a)},start:function(a){a=a||this.modules;for(var b=0,c=a.length;c>b;b++)a[b].start()},stop:function(a){a=a||this.modules;for(var b=0,c=a.length;c>b;b++)a[b].stop()},registerModule:function(b,c,d,e){var f=this.modules;if(c=c||void 0,d=d||[],e=e||[],c&&a.Module[c]){var g=f.length;b.data("terrific-id",g),f[g]=new a.Module[c](b,this.sandbox,g);for(var h=0,i=d.length;i>h;h++){var j=d[h];a.Module[c][j]&&(f[g]=f[g].getDecoratedModule(c,j))}for(var h=0,i=e.length;i>h;h++)this.registerConnection(e[h],f[g]);return f[g]}return null},registerConnection:function(b,c){b=$.trim(b);var d,e,f,g=b.split("-");if(1===g.length?f=e=g[0]:2===g.length&&(d=g[0],e=g[1],f=d+e),f){var h=this.connectors;h[f]||(d?a.Connector[d]&&(h[f]=new a.Connector[d](e)):h[f]=new a.Connector(e)),h[f]&&(c.attachConnector(h[f]),h[f].registerComponent(c))}},unregisterConnection:function(a,b){var c=this.connectors[a];c&&(c.unregisterComponent(b),b.detachConnector(c))}}),a.Sandbox=Class.extend({init:function(a,b){this.application=a,this.config=b,this.hooks={after:[],end:[]}},addModules:function(a){var b=[],c=this.application;return a&&(b=c.registerModules(a),c.start(b)),b},removeModules:function(a){var b=this,c=this.application;if(!$.isArray(a)){var d=a,e=[];d.find(".mod").add(d).each(function(){var a=$(this).data("terrific-id");void 0!==a&&(module=b.getModuleById(a),module&&e.push(module))}),a=e}a&&(c.stop(a),c.unregisterModules(a))},subscribe:function(b,c){var d=this.application;c instanceof a.Module&&b&&(b+="",d.registerConnection(b,c))},unsubscribe:function(b,c){var d=this.application;c instanceof a.Module&&b&&(b+="",d.unregisterConnection(b,c))},getModuleById:function(a){var b=this.application;if(void 0!==b.modules[a])return b.modules[a];throw new Error("the module with the id "+a+" does not exist")},getConfig:function(){return this.config},getConfigParam:function(a){var b=this.config;if(void 0!==b[a])return b[a];throw new Error("the config param "+a+" does not exist")},addCallback:function(a,b){null==b&&(a="end"),this.hooks[a].push(b)},ready:function(a){var b=this.hooks.after;if(b.push(a),this.application.modules.length===b.length){for(var c=0;c<b.length;c++){var d=b[c];"function"==typeof d&&(delete b[c],d())}for(var e=this.hooks.end,c=0;c<e.length;c++){var f=e[c];"function"==typeof f&&f()}}}}),a.Module=Class.extend({init:function(a,b,c){this.$ctx=a,this.id=c,this.connectors={},this.sandbox=b},start:function(){var a=this;this.on&&this.on(function(){a.initAfter()})},stop:function(){var a=this.$ctx;$("*",a).unbind().removeData(),a.unbind().removeData()},initAfter:function(){var a=this;this.sandbox.ready(function(){a.after&&a.after()})},fire:function(b,c,d,e){var f=this,g=this.connectors,h=!0;null==d&&null==e?"function"==typeof c?(e=c,c=void 0):$.isArray(c)&&(d=c,c=void 0):null==e&&("function"==typeof d&&(e=d,d=void 0),$.isArray(c)&&(d=c,c=void 0)),b=a.Utils.String.capitalize(b),c=c||{},d=d||Object.keys(g);for(var i=0,j=d.length;j>i;i++){var k=d[i];if(!g.hasOwnProperty(k))throw new Error("the module #"+f.id+" is not connected to connector "+k);var l=g[k],m=l.notify(f,"on"+b,c)||!1;m||(h=!1)}h&&"function"==typeof e&&e(c)},attachConnector:function(a){this.connectors[a.connectorId]=a},detachConnector:function(a){delete this.connectors[a.connectorId]},getDecoratedModule:function(b,c){if(a.Module[b][c]){var d=a.Module[b][c];return d.prototype=this,d.prototype.constructor=a.Module[b][c],new d(this)}return null}}),a.Connector=Class.extend({init:function(a){this.connectorId=a,this.components={}},registerComponent:function(a){this.components[a.id]={component:a}},unregisterComponent:function(a){var b=this.components;b[a.id]&&delete b[a.id]},notify:function(a,b,c){var d=!0,e=this.components;for(var f in e)if(e.hasOwnProperty(f)){var g=e[f].component;g!==a&&g[b]&&g[b](c)===!1&&(d=!1)}return d}}),a.Utils={},Object.keys||(Object.keys=function(a){var b,c=[];for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);return c}),a.Utils.String={capitalize:function(a){return a.substr(0,1).toUpperCase().concat(a.substr(1))},toCamel:function(a){return a.replace(/(\-[A-Za-z])/g,function(a){return a.toUpperCase().replace("-","")})}}}).call(this),Tc.Module.prototype.subscribe=function(a){var b,c=0,d=arguments,e=d.length;for(c;e>c;c++)b=a[c],this.sandbox.subscribe(b,this);return!0},Tc.Module.prototype.$$=function(a){return this.$ctx.find(a)},Tc.Module.prototype.bindAll=function(){var a,b=0,c=arguments,d=c.length;for(b;d>b;b++){if(a=c[b],"function"!=typeof this[a])throw new TypeError("string"==typeof a?"bindAll: Tc.Module."+this.getName()+"."+a+" is not a function":"Arguments to bindAll must be strings");this[a]=jQuery.proxy(this,a)}return!0},Tc.Module.prototype.getName=function(){var a;if(!this._modName)a:for(a in Tc.Module)if(Tc.Module.hasOwnProperty(a)&&"constructor"!==a&&this instanceof Tc.Module[a]){this._modName=a;break a}return this._modName},Tc.Module.prototype.subscribe=function(a){var b,c=0,d=arguments,e=d.length;for(c;e>c;c++)b=a[c],this.sandbox.subscribe(b,this);return!0},function(){var a={};Tc.Module.prototype.template=function b(c,d){var e=/\W/.test(c)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+c.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*\}\}>)/g,"	").split("'").join("\\'").split("	").join("'").replace(/\{\{=(.+?)\}\}/g,"',$1,'").split("{{").join("');").split("}}").join("p.push('")+"');}return p.join('');"):a[c]=a[c]||b(document.getElementById(c).innerHTML);return d?e(d):e}}(),function(){Tc.Module.PageController=Tc.Module.extend({init:function(a,b,c){this._super(a,b,c)},on:function(a){a()},after:function(){}})}(Tc.$),function(){Tc.Module.Example=Tc.Module.extend({init:function(a,b,c){this._super(a,b,c)},on:function(a){this.$ctx.append('\n<br><span class="debug">JS Module &quot;example&quot; started</span>'),a()},after:function(){}})}(Tc.$),function(){Tc.Module.Example.Alternate=function(a){this.on=function(b){a.on(b),a.$ctx.append('\n<br><span class="debug">JS skin &quot;Example.Alternate&quot; started</span>')},this.after=function(){a.after()}}}(Tc.$),(-1!=navigator.userAgent.indexOf("Windows Phone")||-1!=navigator.userAgent.indexOf("WP7"))&&(document.documentElement.className+=" wp7"),$(document.documentElement).removeClass("no-js"),function(a,b){a.xtc&&a.xtc.isTest||$(function(){var c,d,e=$("body"),f={};c=new b.Application(e,f),c.registerModules(),c.registerModule(e,"PageController"),a.xtc&&a.xtc.ModuleTests&&(d=new xtc.ModuleTests(c)),c.start(),d&&d(function(a){a()})})}(window,Tc);